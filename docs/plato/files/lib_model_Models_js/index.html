<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - lib\model\Models.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet">
  <link href="../../assets/css/plato.css" rel="stylesheet">
  <link href="../../assets/css/plato-file.css" rel="stylesheet">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="http://github.com/es-analysis/plato">Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>lib\model\Models.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">74.70</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">245</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">22.40</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">1.08</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">/**
 * @ngdoc service
 * @name predicsis.jsSDK.models.Models
 * @requires $q
 * @requires Restangular
 * @requires Jobs
 * @requires $injector
 * @description
 * &lt;table&gt;
 *   &lt;tr&gt;
 *     &lt;td&gt;&lt;span class=&quot;badge post&quot;&gt;post&lt;/span&gt; &lt;kbd&gt;/models&lt;/kbd&gt;&lt;/td&gt;
 *     &lt;td&gt;&lt;kbd&gt;{@link predicsis.jsSDK.models.Models#methods_create Models.create()}&lt;/kbd&gt;&lt;/td&gt;
 *     &lt;td&gt;&lt;span class=&quot;badge async&quot;&gt;async&lt;/span&gt;&lt;/td&gt;
 *   &lt;/tr&gt;
 *   &lt;tr&gt;
 *     &lt;td&gt;&lt;span class=&quot;badge post&quot;&gt;post&lt;/span&gt; &lt;kbd&gt;/models&lt;/kbd&gt;&lt;/td&gt;
 *     &lt;td&gt;&lt;kbd&gt;{@link predicsis.jsSDK.models.Models#methods_create Models.createClassifier()}&lt;/kbd&gt;&lt;/td&gt;
 *     &lt;td&gt;&lt;span class=&quot;badge async&quot;&gt;async&lt;/span&gt;&lt;/td&gt;
 *   &lt;/tr&gt;
 *   &lt;tr&gt;
 *     &lt;td&gt;&lt;span class=&quot;badge get&quot;&gt;get&lt;/span&gt; &lt;kbd&gt;/models&lt;/kbd&gt;&lt;/td&gt;
 *     &lt;td&gt;&lt;kbd&gt;{@link predicsis.jsSDK.models.Models#methods_all Models.all()}&lt;/kbd&gt;&lt;/td&gt;
 *     &lt;td&gt;&lt;/td&gt;
 *   &lt;/tr&gt;
 *   &lt;tr&gt;
 *     &lt;td&gt;&lt;span class=&quot;badge get&quot;&gt;get&lt;/span&gt; &lt;kbd&gt;/models/:id&lt;/kbd&gt;&lt;/td&gt;
 *     &lt;td&gt;&lt;kbd&gt;{@link predicsis.jsSDK.models.Models#methods_get Models.get()}&lt;/kbd&gt;&lt;/td&gt;
 *     &lt;td&gt;&lt;/td&gt;
 *   &lt;/tr&gt;
 *   &lt;tr&gt;
 *     &lt;td&gt;&lt;span class=&quot;badge patch&quot;&gt;patch&lt;/span&gt; &lt;kbd&gt;/models/:id&lt;/kbd&gt;&lt;/td&gt;
 *     &lt;td&gt;&lt;kbd&gt;{@link predicsis.jsSDK.models.Models#methods_update Models.update()}&lt;/kbd&gt;&lt;/td&gt;
 *     &lt;td&gt;&lt;span class=&quot;badge async&quot;&gt;async&lt;/span&gt;&lt;/td&gt;
 *   &lt;/tr&gt;
 *   &lt;tr&gt;
 *     &lt;td&gt;&lt;span class=&quot;badge delete&quot;&gt;delete&lt;/span&gt; &lt;kbd&gt;/models/:id&lt;/kbd&gt;&lt;/td&gt;
 *     &lt;td&gt;&lt;kbd&gt;{@link predicsis.jsSDK.models.Models#methods_delete Models.delete()}&lt;/kbd&gt;&lt;/td&gt;
 *     &lt;td&gt;&lt;/td&gt;
 *   &lt;/tr&gt;
 *   &lt;tr&gt;
 *     &lt;td&gt;Wraps all API requests for a learn&lt;/td&gt;
 *     &lt;td colspan=&quot;2&quot;&gt;&lt;kbd&gt;{@link predicsis.jsSDK.models.Models#methods_learn Models.learn()}&lt;/kbd&gt;&lt;/td&gt;
 *   &lt;/tr&gt;
 *   &lt;tfoot&gt;
 *     &lt;tr&gt;&lt;td colspan=&quot;3&quot;&gt;Official documentation is available at:
 *       &lt;ul&gt;
 *         &lt;li&gt;https://developer.predicsis.com/doc/v1/predictive_models/&lt;/li&gt;
 *         &lt;li&gt;https://developer.predicsis.com/doc/v1/predictive_models/classifier/&lt;/li&gt;
 *       &lt;/ul&gt;
 *     &lt;/td&gt;&lt;/tr&gt;
 *   &lt;/tfoot&gt;
 * &lt;/table&gt;
 *
 * Output example:
 * &lt;pre&gt;
 *   {
 *     id: &quot;54c25b446170700001a80300&quot;,
 *     created_at: &quot;2015-01-23T14:31:32.797Z&quot;,
 *     updated_at: &quot;2015-01-23T14:31:34.060Z&quot;,
 *     title: &quot;&quot;,
 *     type: &quot;classifier&quot;,
 *     user_id: &quot;541b06dc617070006d060000&quot;,
 *     preparation_rules_set_id: null,
 *     job_ids: [ &quot;54c25b446170700001a90300&quot; ],
 *     model_variables: [
 *       {
 *         name: &quot;Petal Width&quot;,
 *         level: 0.669445,
 *         weight: 0.789933,
 *         maximum_a_posteriori: true
 *       },
 *       {
 *         name: &quot;Sepal Length&quot;,
 *         level: 0.324718,
 *         weight: 0.415522,
 *         maximum_a_posteriori: false
 *       },
 *       {
 *         name: &quot;Petal Length&quot;,
 *         level: 0.625078,
 *         weight: 0.392422,
 *         maximum_a_posteriori: false
 *       },
 *       {
 *         name: &quot;Sepal Width&quot;,
 *         level: 0.165768,
 *         weight: 0.343345,
 *         maximum_a_posteriori: false
 *       }
 *     ]
 *   }
 * &lt;/pre&gt;
 */
angular
  .module(&#039;predicsis.jsSDK.models&#039;)
  .service(&#039;Models&#039;, function($q, $injector, Restangular, Jobs) {
    &#039;use strict&#039;;
    var self = this;

    function model(id) { return Restangular.one(&#039;models&#039;, id); }
    function models() { return Restangular.all(&#039;models&#039;); }

    // -----------------------------------------------------------------------------------------------------------------

    /**
     * @ngdoc function
     * @name createClassifier
     * @methodOf predicsis.jsSDK.models.Models
     * @description Create a new classifier.
     * Simple shortcut for &lt;code&gt;{@link predicsis.jsSDK.models.Models#method_create Models.create()} function.
     *
     * @param {String} preparationRulesSetId See {@link predicsis.jsSDK.PreparationRules preparation rules} documentation
     * @return {Promise} A new classifier
     */
    this.createClassifier = function(preparationRulesSetId) {
      return self.create({type: &#039;classifier&#039;, preparation_rules_set_id: preparationRulesSetId});
    };

    // -----------------------------------------------------------------------------------------------------------------

    /**
     * @ngdoc function
     * @name create
     * @methodOf predicsis.jsSDK.models.Models
     * @description Create a model
     *
     *  This request is able to create different types of models:
     *
     *  &lt;ul&gt;
     *    &lt;li&gt;supervised classification:
     *    &lt;pre&gt;
     *      {
     *        type: &quot;classifier&quot;,
     *        preparation_rules_set_id: &quot;53fe176070632d0fc5100000&quot;
     *      }
     *    &lt;/pre&gt;
     *    &lt;/li&gt;
     *  &lt;/ul&gt;
     *
     * @param {Object} params See above example.
     * @return {Promise} New model
     */
    this.create = function(params) {
      return Jobs.wrapAsyncPromise(models().post({model: params}))
        .then(function(result) {
          return model(result.id).get();
        });
    };

    /**
     * @ngdoc function
     * @name all
     * @methodOf predicsis.jsSDK.models.Models
     * @description Get all (or a list of) models
     * @param {Array} [modelIds] List of models ids you want to fetch
     * @return {Promise} A list of models
     */
    this.all = function(modelIds) {
      if(modelIds === undefined) {
        return models().getList();
      } else {
        modelIds = modelIds || [];

        return $q.all(modelIds.map(function(id) {
          return model(id).get();
        }));
      }
    };

    /**
     * @ngdoc function
     * @name get
     * @methodOf predicsis.jsSDK.models.Models
     * @description Get a single model by its id
     * @param {String} id Model identifier
     * @return {Promise} A model
     */
    this.get = function(id) {
      return model(id).get();
    };

    /**
     * @ngdoc function
     * @name update
     * @methodOf predicsis.jsSDK.models.Models
     * @description Update specified model
     *  You can update the following parameters:
     *  &lt;ul&gt;
     *    &lt;li&gt;&lt;code&gt;{String} name&lt;/code&gt;&lt;/li&gt;
     *  &lt;/ul&gt;
     *
     * @param {String} id Id of the model you want to update
     * @param {Object} changes see above description to know parameters you are able to update
     * @return {Promise} Updated model
     */
    this.update = function(id, changes) {
      return Jobs.wrapAsyncPromise(model(id).patch({model: changes}))
        .then(function(result) {
          return model(result.id).get();
        });
    };

    /**
     * @ngdoc function
     * @name delete
     * @methodOf predicsis.jsSDK.models.Models
     * @description Permanently destroy a specified model
     * @param {String} id Id of the model you want to remove
     * @return {Promise} A removed model
     */
    this.delete = function(id) {
      return model(id).remove();
    };

    // -----------------------------------------------------------------------------------------------------------------

    /**
     * @ngdoc function
     * @name learn
     * @methodOf predicsis.jsSDK.models.Models
     * @description Learn a model
     *
     * This function wraps the following requests:
     * &lt;ul&gt;
     *   &lt;li&gt;GET /datasets&lt;/li&gt;
     *   &lt;li&gt;GET /datasets/:trainDatasetId&lt;/li&gt;
     *   &lt;li&gt;GET /datasets/:testDatasetId&lt;/li&gt;
     *   &lt;li&gt;POST /preparation_rules_sets&lt;/li&gt;
     *   &lt;li&gt;POST /models&lt;/li&gt;
     *   &lt;li&gt;POST /reports&lt;/li&gt;
     *   &lt;li&gt;POST /reports&lt;/li&gt;
     *   &lt;li&gt;POST /reports&lt;/li&gt;
     *   &lt;li&gt;PATCH /projects/:projectId&lt;/li&gt;
     * &lt;/ul&gt;
     *
     * ... and each time, waits for job termination!
     *
     * To do so, what we really use are the following parameters:
     * &lt;ul&gt;
     *   &lt;li&gt;&lt;kbd&gt;project.learning_dataset_id&lt;/kbd&gt; to find the training partition of the input dataset&lt;/li&gt;
     *   &lt;li&gt;&lt;kbd&gt;project.target_variable_id&lt;/kbd&gt; to create a valid {@link predicsis.jsSDK.models.PreparationRules PreparationRules}&lt;/li&gt;
     *   &lt;li&gt;&lt;kbd&gt;project.id&lt;/kbd&gt; to store preparation rules set, classifier and reports ids.&lt;/li&gt;
     * &lt;/ul&gt;
     *
     * Please also note that if your project doesn&#039;t have a &lt;code&gt;main_modality&lt;/code&gt; parameter, only univariate
     * supervised report will be created. If this property is here, we also generate classifier evaluation reports
     * for train and test datasets.
     *
     * We also broadcast the following events:
     * &lt;ul&gt;
     *   &lt;li&gt;jsSDK.learn.start-retrieving-train-dataset&lt;/li&gt;
     *   &lt;li&gt;jsSDK.learn.start-creating-preparation-rules&lt;/li&gt;
     *   &lt;li&gt;jsSDK.learn.start-learning&lt;/li&gt;
     *   &lt;li&gt;jsSDK.learn.start-generating-reports&lt;/li&gt;
     *   &lt;li&gt;jsSDK.learn.start-updating-project&lt;/li&gt;
     * &lt;/ul&gt;
     *
     * @param {Object} project Instance of a valid {@link predicsis.jsSDK.models.Projects Project}
     * @return {Object} Instance of a complete {@link predicsis.jsSDK.models.Models Models}
     */
    this.learn = function(project) {
      var Models = this;
      var Datasets = $injector.get(&#039;Datasets&#039;);
      var Reports = $injector.get(&#039;Reports&#039;);
      var Projects = $injector.get(&#039;Projects&#039;);
      var PreparationRules = $injector.get(&#039;PreparationRules&#039;);
      var $rootScope = $injector.get(&#039;$rootScope&#039;);
      var results = {};

      $rootScope.$broadcast(&#039;jsSDK.learn.start-retrieving-train-dataset&#039;);

      return Datasets.getChildren(project.learning_dataset_id, project.dictionary_id)
        // create preparation rules
        .then(function(children) {
          if(!children.train) {
            throw &#039;Invalid project on POST preparation_rules, no valid train dataset found&#039;;
          }

          $rootScope.$broadcast(&#039;jsSDK.learn.start-creating-preparation-rules&#039;);

          return PreparationRules.create({
            variable_id: project.target_variable_id,
            dataset_id: children.train.id
          });
        })

        // create the model from preparation rules set
        .then(function(preparationRulesRet) {
          results.preparation_rules_set = preparationRulesRet;
          $rootScope.$broadcast(&#039;jsSDK.learn.start-learning&#039;);
          return Models.createClassifier(preparationRulesRet.id);
        })

        // generate reports
        .then(function(classifier) {
          results.classifier = classifier;
          // classifier_id is required to generate reports,
          // but the PATCH request will occurs after the learn process.
          // this tweak allow project generation.
          project.classifier_id = classifier.id;
          $rootScope.$broadcast(&#039;jsSDK.learn.start-generating-reports&#039;);

          var requestedReports = {
            univariate_supervised_report: Reports.createUnivariateSupervisedReport(project)
          };

          if (project.main_modality !== null) {
            requestedReports[&#039;train_classifier_evaluation_report&#039;] = Reports.createTrainClassifierEvaluationReport(project);
            requestedReports[&#039;test_classifier_evaluation_reports&#039;] = Reports.createTestClassifierEvaluationReport(project);
          }

          return $q.all(requestedReports);
        })

        //update project
        .then(function(reports) {
          var reportIds = [];
          reportIds[0] = reports.train_classifier_evaluation_report.id;
          reportIds[1] = reports.test_classifier_evaluation_reports.id;
          reportIds[2] = reports.univariate_supervised_report.id;
          //reportIds[3] = reports.univariate_unsupervised_report.id;

          $rootScope.$broadcast(&#039;jsSDK.learn.start-updating-project&#039;);

          return Projects.update(project.id, {
            preparation_rules_set_id: results.preparation_rules_set.id,
            classifier_id: results.classifier.id,
            report_ids: reportIds
          });
        })

        //return classifier
        .then(function() {
          return results.classifier;
        });
    };

  });</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
